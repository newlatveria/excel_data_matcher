<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDM Test Protocol & Data Generator (v2)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; line-height: 1.6; padding: 40px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        h1 { color: #2c3e50; margin-bottom: 10px; text-align: center; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 40px; }
        
        .download-section { text-align: center; margin-bottom: 50px; padding: 30px; background: #e8f6f3; border-radius: 8px; border: 2px dashed #1abc9c; }
        .btn { 
            background: linear-gradient(135deg, #1abc9c, #16a085); 
            color: white; padding: 18px 35px; font-size: 1.2em; 
            border: none; border-radius: 6px; cursor: pointer; 
            font-weight: bold; transition: transform 0.2s, box-shadow 0.2s; 
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(26, 188, 156, 0.4); }

        h2 { color: #34495e; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; margin-top: 40px; margin-bottom: 20px; }
        
        .scenario { background: #fff; border: 1px solid #e0e0e0; border-left: 5px solid #3498db; border-radius: 4px; padding: 20px; margin-bottom: 20px; }
        .scenario h3 { margin-bottom: 10px; color: #2980b9; }
        .scenario ul { margin-left: 20px; }
        .scenario li { margin-bottom: 5px; }
        
        code { background: #f7f9fa; padding: 2px 5px; border-radius: 3px; color: #c0392b; font-family: 'Consolas', monospace; }
        .pass-criteria { font-weight: bold; color: #27ae60; margin-top: 10px; display: block; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸ§ª EDM Robust Test Protocol (v2)</h1>
        <p class="subtitle">Generates a 30+ row dataset for stress-testing Grouping, Deduplication, and Robust Matching.</p>

        <div class="download-section">
            <button class="btn" onclick="generateFile()">ðŸ“¥ Download "EDM_Stress_Test_v2.xlsx"</button>
            <p style="margin-top: 15px; font-size: 0.9em; color: #555;">Contains 3 Sheets with 30+ rows each, including Dates, Fuzzy Typos, and Ragged Data.</p>
        </div>

        <h2>Audit Instructions</h2>

        <div class="scenario" style="border-left-color: #8e44ad;">
            <h3>1. Setup</h3>
            <ul>
                <li>Open the <strong>Excel Data Master (EDM)</strong> application.</li>
                <li>Upload the <code>EDM_Stress_Test_v2.xlsx</code> file.</li>
            </ul>
        </div>

        <div class="scenario">
            <h3>Scenario A: New "Grouping" Feature</h3>
            <p><strong>Goal:</strong> Group 35 transaction records by their Department/Category.</p>
            <p><strong>1.</strong> Select <strong>only</strong> <code>Sheet 3 (Transactions)</code>.</p>
            <p><strong>2.</strong> In "Data Grouping & Cleaning", check <strong>Department</strong>.</p>
            <p><strong>3.</strong> Click <strong>Group Data by Selected Columns</strong>.</p>
            <span class="pass-criteria">âœ… PASS IF: You see groups like "Group 1: Department: Sales (10 rows)" and "Group 2: Department: IT (8 rows)".</span>
        </div>

        <div class="scenario">
            <h3>Scenario B: Robust "Word Order" Match</h3>
            <p><strong>Goal:</strong> Verify "John Smith" matches "Smith John".</p>
            <p><strong>1.</strong> Select <code>Sheet 1 (Master_CRM)</code> and <code>Sheet 2 (Incoming_Data)</code>.</p>
            <p><strong>2.</strong> Check <strong>Enable Robust Exact Match</strong>.</p>
            <p><strong>3.</strong> Run <strong>Exhaustive Match</strong>.</p>
            <span class="pass-criteria">âœ… PASS IF: "Tony Stark" (Sheet 1) matches "Stark, Tony" AND "Stark Tony" (Sheet 2).</span>
        </div>

        <div class="scenario">
            <h3>Scenario C: Date Alignment & Ragged Data</h3>
            <p><strong>Goal:</strong> Ensure empty leading cells don't shift data.</p>
            <p><strong>1.</strong> Look at the results for <strong>Sheet 1</strong>.</p>
            <p><strong>2.</strong> Find <strong>Row 30</strong> (Bruce Wayne).</p>
            <span class="pass-criteria">âœ… PASS IF: The email column in Sheet 2 contains an email address, NOT a date or empty space, despite previous cells being empty.</span>
        </div>
    </div>

    <script>
        function generateFile() {
            const wb = XLSX.utils.book_new();

            // --- SHEET 1: "Master_CRM" (Clean Data, 30+ Rows) ---
            const header1 = ["ID", "Full Name", "Department", "Email Address", "Date Joined", "Notes (Ignore)"];
            const rows1 = [
                [101, "Tony Stark", "Engineering", "tony@stark.com", new Date("2020-01-01"), "vip"],
                [102, "Steve Rogers", "Operations", "steve@shield.gov", new Date("2020-02-15"), "active"],
                [103, "Natasha Romanoff", "Operations", "nat@shield.gov", new Date("2020-03-10"), "active"],
                [104, "Bruce Banner", "Science", "bruce@gamma.lab", new Date("2020-04-01"), "active"],
                [105, "Thor Odinson", "Management", "thor@asgard.realm", new Date("2020-05-20"), "remote"],
                [106, "Clint Barton", "Operations", "clint@hawkeye.com", new Date("2020-06-15"), "active"],
                [107, "Wanda Maximoff", "Magic", "wanda@westview.com", new Date("2020-07-30"), "hybrid"],
                [108, "Vision", "IT", "vision@android.net", new Date("2020-08-12"), "remote"],
                [109, "Peter Parker", "Internship", "peter@dailybugle.com", new Date("2020-09-01"), "part-time"],
                [110, "Stephen Strange", "Magic", "doctor@strange.com", new Date("2020-10-31"), "consultant"],
                [111, "T'Challa", "Management", "king@wakanda.gov", new Date("2020-11-11"), "vip"],
                [112, "Scott Lang", "Engineering", "scott@pym.tech", new Date("2020-12-05"), "contractor"],
                [113, "Hope Van Dyne", "Engineering", "hope@pym.tech", new Date("2021-01-20"), "active"],
                [114, "Carol Danvers", "Operations", "captain@marvel.space", new Date("2021-02-28"), "remote"],
                [115, "Nick Fury", "Management", "fury@shield.gov", new Date("2021-03-15"), "director"],
                [116, "Maria Hill", "Operations", "hill@shield.gov", new Date("2021-04-10"), "active"],
                [117, "Sam Wilson", "Operations", "falcon@airforce.mil", new Date("2021-05-05"), "active"],
                [118, "Bucky Barnes", "Operations", "wintersoldier@hydra.old", new Date("2021-06-01"), "active"],
                [119, "Loki Laufeyson", "Management", "loki@tva.time", new Date("2021-07-07"), "contractor"],
                [120, "Sylvie", "Management", "sylvie@tva.time", new Date("2021-08-08"), "contractor"],
                [121, "Shang-Chi", "Operations", "shang@tenrings.org", new Date("2021-09-09"), "active"],
                [122, "Katy Chen", "Transport", "katy@valet.com", new Date("2021-10-10"), "active"],
                [123, "Wong", "Magic", "wong@library.kamar", new Date("2021-11-11"), "librarian"],
                [124, "America Chavez", "Travel", "america@multiverse.org", new Date("2021-12-12"), "intern"],
                [125, "Kate Bishop", "Internship", "kate@hawkeye.com", new Date("2022-01-01"), "intern"],
                [126, "Yelena Belova", "Operations", "yelena@widow.ops", new Date("2022-02-02"), "contractor"],
                [127, "Marc Spector", "Security", "moon@knight.egypt", new Date("2022-03-03"), "night-shift"],
                [128, "Steven Grant", "Retail", "steven@museum.uk", new Date("2022-04-04"), "day-shift"],
                [129, "Jennifer Walters", "Legal", "jen@law.hulk", new Date("2022-05-05"), "lawyer"],
                [130, "Matt Murdock", "Legal", "matt@nelsonmurdock.com", new Date("2022-06-06"), "lawyer"]
            ];
            const ws1 = XLSX.utils.aoa_to_sheet([header1, ...rows1]);
            XLSX.utils.book_append_sheet(wb, ws1, "Master_CRM");

            // --- SHEET 2: "Incoming_Data" (Messy, Ragged, 30+ Rows) ---
            const header2 = ["Import_ID", "Raw Name", "Matched Email", "Status Code"];
            const rows2 = [
                ["IMP_01", "Tony Stark", "tony@stark.com", "OK"], // Exact
                ["IMP_02", "stark, tony", "tony@stark.com", "CASE_PUNCT"], // Robust Punctuation
                ["IMP_03", "Stark Tony", "tony@stark.com", "WORD_ORDER"], // Robust Word Order (Crucial Test)
                ["IMP_04", "Rogers, Steve", "steve@shield.gov", "OK"],
                ["IMP_05", "Natasha  Romanoff", "nat@shield.gov", "SPACE"],
                ["IMP_06", "Bruce Baner", "bruce@gamma.lab", "FUZZY_TYPO"], // Fuzzy
                ["IMP_07", "Odinson, Thor", "thor@asgard.realm", "OK"],
                ["IMP_08", "Clint  Barton", "clint@hawkeye.com", "SPACE"],
                ["IMP_09", "Wanda Maximof", "wanda@westview.com", "FUZZY"],
                ["IMP_10", "Vision Android", "vision@android.net", "PARTIAL"],
                ["IMP_11", "Parker, Peter", "peter@dailybugle.com", "OK"],
                ["IMP_12", "Dr. Strange", "doctor@strange.com", "TITLE_ADDED"], // Fuzzy might catch
                ["IMP_13", "TChalla", "king@wakanda.gov", "PUNCT_MISSING"],
                ["IMP_14", "Scott Lang", "scott@pym.tech", "OK"],
                ["IMP_15", "Hope VanDyne", "hope@pym.tech", "SPACE_MISSING"],
                ["IMP_16", "Danvers Carol", "captain@marvel.space", "WORD_ORDER"],
                ["IMP_17", "Fury, Nick", "fury@shield.gov", "OK"],
                ["IMP_18", "Maria  Hill", "hill@shield.gov", "SPACE"],
                ["IMP_19", "Sam Wilson", "falcon@airforce.mil", "OK"],
                ["IMP_20", "Barnes, Bucky", "wintersoldier@hydra.old", "OK"],
                ["IMP_21", "Loki", "loki@tva.time", "PARTIAL"],
                ["IMP_22", "Sylvie Laufeydottir", "sylvie@tva.time", "ADDED_NAME"],
                ["IMP_23", "Shang Chi", "shang@tenrings.org", "HYPHEN_TO_SPACE"],
                ["IMP_24", "Katy", "katy@valet.com", "PARTIAL"],
                ["IMP_25", "Wong The Sorcerer", "wong@library.kamar", "ADDED_TITLE"],
                ["IMP_26", "America Chavez", "america@multiverse.org", "OK"],
                ["IMP_27", "Bishop, Kate", "kate@hawkeye.com", "OK"],
                ["IMP_28", "Yelena Belova", "yelena@widow.ops", "OK"],
                ["IMP_29", "Mark Spector", "moon@knight.egypt", "FUZZY_NAME"], // Marc vs Mark
                // RAGGED DATA TEST: Empty leading cells for Row 30
                ["IMP_30", "", "bruce@gamma.lab", "MISSING_NAME_ALIGNMENT_TEST"] 
            ];
            const ws2 = XLSX.utils.aoa_to_sheet([header2, ...rows2]);
            XLSX.utils.book_append_sheet(wb, ws2, "Incoming_Data");

            // --- SHEET 3: "Transactions" (For Grouping & Dedupe, 30+ Rows) ---
            const header3 = ["Trans_ID", "Department", "Expense Type", "Amount", "Date"];
            const rows3 = [
                ["TX_001", "Sales", "Travel", 500, "2023-01-01"],
                ["TX_002", "Sales", "Meals", 120, "2023-01-02"],
                ["TX_003", "Sales", "Travel", 600, "2023-01-03"],
                ["TX_004", "Sales", "Supplies", 50, "2023-01-04"],
                ["TX_005", "IT", "Hardware", 1200, "2023-01-05"],
                ["TX_006", "IT", "Software", 300, "2023-01-06"],
                ["TX_007", "IT", "Hardware", 1200, "2023-01-05"], // EXACT DUPLICATE of TX_005
                ["TX_008", "IT", "Services", 150, "2023-01-08"],
                ["TX_009", "HR", "Training", 2000, "2023-01-09"],
                ["TX_010", "HR", "Recruiting", 500, "2023-01-10"],
                ["TX_011", "HR", "Training", 2000, "2023-01-09"], // EXACT DUPLICATE of TX_009
                ["TX_012", "HR", "Meals", 100, "2023-01-12"],
                ["TX_013", "Marketing", "Ads", 5000, "2023-01-13"],
                ["TX_014", "Marketing", "Events", 3000, "2023-01-14"],
                ["TX_015", "Marketing", "Ads", 1000, "2023-01-15"],
                ["TX_016", "Sales", "Travel", 450, "2023-01-16"],
                ["TX_017", "Sales", "Travel", 450, "2023-01-16"], // EXACT DUPLICATE of TX_016
                ["TX_018", "IT", "Software", 299, "2023-01-18"],
                ["TX_019", "Operations", "Logistics", 800, "2023-01-19"],
                ["TX_020", "Operations", "Supplies", 200, "2023-01-20"],
                ["TX_021", "Operations", "Logistics", 800, "2023-01-19"], // EXACT DUPLICATE of TX_019
                ["TX_022", "Finance", "Audit", 5000, "2023-01-22"],
                ["TX_023", "Finance", "Tools", 300, "2023-01-23"],
                ["TX_024", "Legal", "Consulting", 1500, "2023-01-24"],
                ["TX_025", "Legal", "Fees", 200, "2023-01-25"],
                ["TX_026", "Sales", "Meals", 80, "2023-01-26"],
                ["TX_027", "Sales", "Meals", 80, "2023-01-26"], // EXACT DUPLICATE
                ["TX_028", "IT", "Hardware", 900, "2023-01-28"],
                ["TX_029", "HR", "Recruiting", 600, "2023-01-29"],
                ["TX_030", "Marketing", "Events", 3500, "2023-01-30"]
            ];
            const ws3 = XLSX.utils.aoa_to_sheet([header3, ...rows3]);
            XLSX.utils.book_append_sheet(wb, ws3, "Transactions");

            // Save File
            XLSX.writeFile(wb, "EDM_Stress_Test_v2.xlsx");
        }
    </script>
</body>
</html>